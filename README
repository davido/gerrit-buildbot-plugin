Buildbot Gerrit Plugin
======================

Buildbot Gerrit Plugin (BGP) is a multi project and multi platform queue manager
for patch verification.

It coordinates the decental located tinderboxes without having a continued
network connection to them by maintaining project and platform specific blocking
queue of tasks for each gerrit patch. A patch set considered verified
(+1) if and only if all tinderbox tasks are reported success back.
In this case gerrit verify status +1 is reported back to gerrit.
In addition log publication is provided by log servlet.

There are a number of build trigger strategies:
PATCHSET_CREATED: build is triggered immediately after new patch set is uploaded
POSITIVE_REVIEW: proposed patch get build if and only if:
* it is not merged
* it has no review < 0,
* it has no verify < 0,
* it has no verify > 0,
* it has at least 1 review > 0 from a user that belong to the `Reviewer` Group
* no build job is pending for this patch set

Workflow description
====================
0. During BGP activation the configuration file buildbot.config is read and
   gerrit-stream event listener is installed.
Depending on trigger strategie for specific project, build is triggered, if
1a. User submit a gerrit patch, PatchSetCreatedEvent is triggered by gerrit and
   consumed by BGP or
1b. The patch get aproved with gerrit `review` ssh command (or through web UI).
   BGP consumes gerrit's CommentAddedEvent, checks if for the project, that event
   is triggered for, BGP is activated and check Norbert's rule:

When build is triggered, the follow actions are taken:
a) create a Gerrit Job instance
b) populate platform task map with verify task per platform.
   Platforms are currently hard coded: WINDOWS, LINUX and MAC.
3. tinderbox that configured gerrit verification
   (see tinbuild2 script in LO repo) periodically calls BGP `get-task` ssh
   command and get gerrit patch for veification. Note that because of blocking
   queue only one tinderbox per platform and per gerrit job get engaged.
   When a tinderbox get assign a test build, repport that in a review message.
4. tinderbox build the recieved gerrit task and report the outcome and the
   the log file with BGP `report` ssh command. When a tinderbox outcome is known
   repport that in a review message (success, failure, canceled)
   Note: these review message do not impact verify status. They just
   provide progress information.
   If --state=canceled is reported, then the task is rescheduled again in the 
   build queue.
5. Once all tasks for a job are ready, the combined verify result is reported
   back to gerrit through BGP.

Contribution:
=============
This is gerrit plugin. Please upload patches for review to this gerrit 
instance: https://review.idaia.de.
